<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Funcleson Funkatorium Board</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      --bg-main: #14151a;
      --bg-panel: #181920;
      --bg-strip: #181920;
      --accent-yellow: #f4c430;
      --accent-yellow-soft: #ffdd6a;
      --text-main: #f9fafb;
      --text-soft: #c3c6d1;
      --text-muted: #8e93a3;
      --divider: #272935;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html,
    body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: var(--bg-main);
      color: var(--text-main);
    }

    body {
      display: flex;
      align-items: stretch;
      justify-content: stretch;
      padding: 0;
      font-size: 20px; /* Slightly larger base font overall */
    }

    .board {
      flex: 1 1 auto;
      width: 100%;
      height: 100vh;           /* fill vertical screen */
      max-width: 1920px;
      display: flex;
      flex-direction: column;
      background: var(--bg-main);
      border-radius: 0;        /* flush with screen edges */
      border: 1px solid #20222c;
      box-shadow: 0 0 25px rgba(0, 0, 0, 0.6);
      overflow: hidden;
      margin: 0 auto;
    }

    /* === HEADER === */
    .board-header {
      flex: 0 0 auto;
      padding: 12px 20px 10px;
      display: flex;
      flex-direction: column;       /* stack vertically */
      align-items: center;          /* center horizontally */
      justify-content: center;
      gap: 8px;
      background: #101119;
      border-bottom: 1px solid var(--divider);
    }

    .venue-name {
      font-size: 2.4rem;
      font-weight: 700;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--accent-yellow-soft);
      text-align: center;           /* ensure centered text */
    }

    /* Right side now becomes a centered column under the title */
    .header-right {
      display: flex;
      flex-direction: column;       /* QR row, then button, then "On Tap" row */
      align-items: center;
      gap: 6px;
    }

    /* QR row centered under the venue name */
    .header-qr-row {
      display: flex;
      align-items: center;
      justify-content: center;      /* center horizontally */
      gap: 20px;
    }

    .section-label {
      font-size: 1.1rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-soft);
    }

    .small-timestamp {
      font-size: 1rem;
      color: var(--text-muted);
    }

    /* === MAIN MENU AREA === */
    .board-main {
      flex: 1 1 auto;
      display: flex;
      gap: 16px;
      padding: 16px 20px;
      background: radial-gradient(circle at top, #1e202b 0%, #13151e 50%, #101119 100%);
    }

    .menu-column {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .beer-row {
      display: flex;
      flex-direction: column;
      padding: 8px 12px;
      border-radius: 4px;
      background: rgba(24, 25, 32, 0.9);
      border: 1px solid rgba(39, 41, 53, 0.9);
    }

    .beer-top {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 12px;
    }

    .beer-name {
      font-size: 1.5rem;
      font-weight: 600;
      letter-spacing: 0.03em;
      text-transform: uppercase;
      color: var(--text-main);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .beer-meta-inline {
      font-size: 1.1rem;
      color: var(--text-soft);
      white-space: nowrap;
      opacity: 0.95;
    }

    .beer-bottom {
      margin-top: 4px;
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      font-size: 1.1rem;
      color: var(--text-muted);
    }

    .beer-style {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .beer-price {
      font-weight: 600;
      color: var(--accent-yellow-soft);
      white-space: nowrap;
    }

    .tap-badge {
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      border-radius: 999px;
      padding: 3px 10px;
      border: 1px solid rgba(244, 196, 48, 0.85);
      color: var(--accent-yellow-soft);
    }

    .featured-tag {
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      border-radius: 999px;
      padding: 3px 10px;
      border: 1px solid rgba(144, 205, 244, 0.8);
      color: #9cd0ff;
      margin-left: 6px;
    }

    /* === FOOTER TICKER === */
    .board-footer {
      flex: 0 0 auto;
      padding: 16px 18px 18px 18px;
      background: #101119;
      border-top: 1px solid var(--divider);
    }

    .ticker-shell {
      width: 100%;
      background: var(--bg-strip);
      border-radius: 10px;
      padding: 14px 24px;
      display: flex;
      align-items: center;
      gap: 20px;
      border: 1px solid #20222c;
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.45);
    }

    .ticker-label {
      flex-shrink: 0;
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid rgba(244, 196, 48, 0.9);
      background: rgba(244, 196, 48, 0.12);
      font-size: 0.9rem;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: var(--accent-yellow-soft);
      display: inline-flex;
      align-items: center;
      gap: 0.45rem;
    }

    .ticker-label-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--accent-yellow);
    }

    .ticker-window {
      flex: 1;
      overflow: hidden;
      position: relative;
      height: 120px;
    }

    .ticker-track {
      position: relative;
      width: 100%;
      height: 100%;
    }

    .ticker-card {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 0.6rem;
    }

    .ticker-line-main {
      display: inline-flex;
      align-items: baseline;
      gap: 0.5rem;
      font-size: 2.2rem;
    }

    .ticker-line-sub {
      display: inline-flex;
      align-items: baseline;
      gap: 0.5rem;
      font-size: 1.5rem;
      color: var(--text-muted);
    }

    .ticker-user {
      font-weight: 600;
      color: var(--accent-yellow);
    }

    .ticker-beer {
      font-weight: 600;
      color: var(--text-main);
    }

    .ticker-rating {
      font-weight: 500;
      color: var(--accent-yellow-soft);
    }

    .ticker-time {
      color: var(--text-muted);
    }

    .ticker-separator {
      color: var(--text-muted);
    }

    .ticker-empty {
      font-size: 2rem;
      color: var(--text-soft);
    }

    .status-pill {
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 2px;
      font-size: 0.85rem;
      line-height: 1.2;
      color: var(--text-muted);
    }

    .status-label {
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-size: 0.7rem;
    }

    .status-time {
      font-size: 0.95rem;
    }

    /* --- Smooth morph-style transition (PowerPoint vibe) --- */
    .ticker-card--incoming {
      opacity: 0;
      transform: translateY(20px) scale(0.96);
      filter: blur(6px);
    }

    .ticker-card--animate-in {
      animation: tickerMorphIn 0.9s ease-in-out forwards;
    }

    .ticker-card--outgoing {
      animation: tickerMorphOut 0.9s ease-in-out forwards;
    }

    @keyframes tickerMorphOut {
      0% {
        opacity: 1;
        transform: translateY(0) scale(1);
        filter: blur(0px);
      }
      40% {
        opacity: 0.8;
        transform: translateY(-6px) scale(0.99);
        filter: blur(2px);
      }
      100% {
        opacity: 0;
        transform: translateY(-14px) scale(0.96);
        filter: blur(6px);
      }
    }

    @keyframes tickerMorphIn {
      0% {
        opacity: 0;
        transform: translateY(18px) scale(1.03);
        filter: blur(6px);
      }
      60% {
        opacity: 1;
        transform: translateY(-3px) scale(1.01);
        filter: blur(2px);
      }
      100% {
        opacity: 1;
        transform: translateY(0) scale(1);
        filter: blur(0px);
      }
    }

    /* === QR BLOCKS (dual neon) === */
    .header-qr-row {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .neon-qr {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 6px 12px;
      border-radius: 999px;
      background: radial-gradient(circle at top left, #ffef9f 0%, #ff6bd5 40%, #4fd1ff 80%, #1b1b2f 100%);
      position: relative;
      overflow: hidden;
      animation: qrGlow 4.5s ease-in-out infinite;
      box-shadow:
        0 0 8px rgba(255, 255, 255, 0.4),
        0 0 18px rgba(255, 107, 213, 0.55),
        0 0 26px rgba(79, 209, 255, 0.55);
    }

    .neon-qr::before {
      content: "";
      position: absolute;
      inset: 2px;
      border-radius: 999px;
      background: #080814;
      opacity: 0.92;
    }

    .neon-qr-inner {
      position: relative;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .neon-qr-text {
      display: flex;
      flex-direction: column;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: #e5e7ff;
    }

    .neon-qr-text strong {
      color: #ffef9f;
      font-size: 0.95rem;
    }

    .neon-qr img {
      width: 70px;
      height: 70px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.25);
      background: #050509;
      box-shadow:
        0 0 8px rgba(255,255,255,0.25),
        0 0 14px rgba(255, 239, 159, 0.45);
    }

    @keyframes qrGlow {
      0% {
        box-shadow:
          0 0 8px rgba(255, 255, 255, 0.4),
          0 0 18px rgba(255, 107, 213, 0.55),
          0 0 26px rgba(79, 209, 255, 0.55);
      }
      50% {
        box-shadow:
          0 0 10px rgba(255, 255, 255, 0.6),
          0 0 24px rgba(255, 107, 213, 0.8),
          0 0 32px rgba(79, 209, 255, 0.8);
      }
      100% {
        box-shadow:
          0 0 8px rgba(255, 255, 255, 0.4),
          0 0 18px rgba(255, 107, 213, 0.55),
          0 0 26px rgba(79, 209, 255, 0.55);
      }
    }

    /* === TV NAV BUTTON (Beer Menu â†’ Slideshow) === */
    .tv-nav-btn {
      margin-top: 6px;
      padding: 0.5rem 1.1rem;
      font-size: 0.9rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      border-radius: 999px;
      border: 1px solid rgba(244, 196, 48, 0.9);
      background: rgba(244, 196, 48, 0.12);
      color: var(--accent-yellow-soft);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.45rem;
    }

    .tv-nav-btn:focus,
    .tv-nav-btn:hover {
      outline: 2px solid rgba(244, 196, 48, 0.9);
      outline-offset: 2px;
      background: rgba(244, 196, 48, 0.2);
      box-shadow: 0 0 14px rgba(244, 196, 48, 0.6);
    }

    @media (max-width: 900px) {
      .board {
        max-height: none;
      }

      .board-main {
        flex-direction: column;
      }

      .menu-column {
        width: 100%;
      }

      .neon-qr img {
        width: 44px;
        height: 44px;
      }
      .neon-qr-text {
        display: none;
      }

      .ticker-label {
        display: none;
      }
    }
  </style>
</head>
<body>
  <div class="board">
    <header class="board-header">
      <div class="venue-name">Funcleson Funkatorium</div>

      <div class="header-right">
        <div class="header-qr-row">

          <!-- Untappd Check-in QR -->
          <div class="neon-qr">
            <div class="neon-qr-inner">
              <div class="neon-qr-text">
                <span>Scan to Check In</span>
                <strong>Untappd Venue</strong>
              </div>
              <img src="qr-funcleson.png" alt="QR code to Untappd Venue" />
            </div>
          </div>

          <!-- Photo Drop QR -->
          <div class="neon-qr">
            <div class="neon-qr-inner">
              <div class="neon-qr-text">
                <span>Scan to Add Photos</span>
                <strong>Photo Drop</strong>
              </div>
              <img src="qr-photodrop.png" alt="QR code for Photo Drop Album" />
            </div>
          </div>

        </div>

        <!-- Button to go to slideshow.html -->
        <a href="slideshow.html" class="tv-nav-btn" id="slideshowBtn">
          ðŸ“¸ View Brewery Photo Slideshow
        </a>

        <span class="section-label">On Tap</span>
        <span class="small-timestamp" id="boardUpdated"></span>
      </div>
    </header>

    <main class="board-main">
      <div class="menu-column" id="menuColumnLeft"></div>
      <div class="menu-column" id="menuColumnRight"></div>
    </main>

    <footer class="board-footer">
      <div class="ticker-shell">
        <div class="ticker-label">
          <span class="ticker-label-dot"></span>
          <span>Live Check-ins</span>
        </div>

        <div class="ticker-window">
          <div class="ticker-track" id="tickerTrack">
            <div class="ticker-content" id="tickerContent">
              <span class="ticker-empty">
                Waiting for check-insâ€¦ open Untappd and log a beer at this venue.
              </span>
            </div>
          </div>
        </div>

        <div class="status-pill">
          <span class="status-label">Status</span>
          <span class="status-time" id="statusTime">Updatingâ€¦</span>
        </div>

      </div>
    </footer>
  </div>

  <script>
    // ========= TAP LIST VIA GOOGLE SHEETS =========
    const GOOGLE_SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS8XJ2EmSMTcR_XrbIegnEEZvGCmix6h9EnEgQi-QwUpIM0JQ0GkdtbiD1X5V29gdG_S81hKd3Eh6QA/pub?output=csv";

    const CATEGORY_FILTERS = [];
    let BEERS = [];

    const boardUpdated = document.getElementById("boardUpdated");

    function parseCSV(csv) {
      const lines = csv.trim().split("\n");
      if (lines.length < 2) return [];

      const headers = lines[0].split(",").map(h => h.trim());
      const beers = [];

      for (let i = 1; i < lines.length; i++) {
        const row = lines[i].split(",").map(c => c.trim());
        if (row.length === 1 && row[0] === "") continue;
        const obj = {};
        headers.forEach((h, idx) => {
          obj[h] = row[idx] || "";
        });
        beers.push(obj);
      }
      return beers;
    }

    async function fetchBeersFromSheet() {
      if (!GOOGLE_SHEET_CSV_URL) {
        console.warn("Google Sheet CSV URL is not set.");
        return;
      }

      try {
        const res = await fetch(GOOGLE_SHEET_CSV_URL);
        const text = await res.text();
        BEERS = parseCSV(text);
        buildMenu();
      } catch (e) {
        console.error("Error loading beer sheet:", e);
      }
    }

    function buildMenu() {
      const leftCol = document.getElementById("menuColumnLeft");
      const rightCol = document.getElementById("menuColumnRight");
      leftCol.innerHTML = "";
      rightCol.innerHTML = "";

      let beers = [...BEERS];

      beers = beers.filter((beer) => {
        const activeStr = (beer.active || beer.Active || "").toString().toLowerCase();
        const isActive =
          activeStr === "" ||
          activeStr === "true" ||
          activeStr === "yes" ||
          activeStr === "y" ||
          activeStr === "1";
        if (!isActive) return false;

        if (CATEGORY_FILTERS.length === 0) return true;
        const cat = (beer.category || beer.Category || "").toString().trim();
        return CATEGORY_FILTERS.includes(cat);
      });

      beers.sort((a, b) => {
        const ca = (a.category || a.Category || "").toString();
        const cb = (b.category || b.Category || "").toString();
        if (ca < cb) return -1;
        if (ca > cb) return 1;
        const ta = parseInt(a.tap || a.Tap || "0", 10) || 0;
        const tb = parseInt(b.tap || b.Tap || "0", 10) || 0;
        return ta - tb;
      });

      const mid = Math.ceil(beers.length / 2);
      const leftBeers = beers.slice(0, mid);
      const rightBeers = beers.slice(mid);

      function renderColumn(list, container) {
        let lastCategory = null;

        list.forEach((beer) => {
          const cat = (beer.category || beer.Category || "").toString().trim();

          if (cat && cat !== lastCategory) {
            const header = document.createElement("div");
            header.className = "section-label";
            header.textContent = cat;
            container.appendChild(header);
            lastCategory = cat;
          }

          const row = document.createElement("div");
          row.className = "beer-row";

          const top = document.createElement("div");
          top.className = "beer-top";

          const name = document.createElement("div");
          name.className = "beer-name";
          name.textContent = beer.name || "";

          const rightMeta = document.createElement("div");
          rightMeta.style.display = "flex";
          rightMeta.style.alignItems = "center";
          rightMeta.style.gap = "6px";

          const tapVal = beer.tap || beer.Tap || "";
          if (tapVal) {
            const tap = document.createElement("span");
            tap.className = "tap-badge";
            tap.textContent = `Tap ${tapVal}`;
            rightMeta.appendChild(tap);
          }

          const featStr = (beer.featured || beer.Featured || "").toString().toLowerCase();
          const isFeatured =
            featStr === "true" || featStr === "yes" || featStr === "y" || featStr === "1";

          if (isFeatured) {
            const feat = document.createElement("span");
            feat.className = "featured-tag";
            feat.textContent = "Featured";
            rightMeta.appendChild(feat);
          }

          top.appendChild(name);
          top.appendChild(rightMeta);

          const bottom = document.createElement("div");
          bottom.className = "beer-bottom";

          const style = document.createElement("div");
          style.className = "beer-style";
          style.textContent = beer.style || beer.brewery || "";

          const price = document.createElement("div");
          price.className = "beer-price";
          price.textContent = beer.price || "";

          bottom.appendChild(style);
          bottom.appendChild(price);

          const metaInline = document.createElement("div");
          metaInline.className = "beer-meta-inline";
          const bits = [];
          if (beer.abv) bits.push(beer.abv);
          if (beer.ibu) bits.push(beer.ibu);
          if (beer.pour) bits.push(beer.pour);
          metaInline.textContent = bits.join(" Â· ");

          row.appendChild(top);
          if (bits.length) row.appendChild(metaInline);
          row.appendChild(bottom);

          container.appendChild(row);
        });
      }

      renderColumn(leftBeers, leftCol);
      renderColumn(rightBeers, rightCol);

      if (boardUpdated) {
        const now = new Date();
        boardUpdated.textContent = "Updated " + now.toLocaleTimeString();
      }
    }

    // ========= TICKER CONFIG =========
    const VENUE_RSS_URL = "https://untappd.com/rss/venue/9899874";
    const REFRESH_MS = 60000;
    const MAX_AGE_HOURS = 7000;

    const tickerTrack = document.getElementById("tickerTrack");
    const tickerContent = document.getElementById("tickerContent");
    const statusTime = document.getElementById("statusTime");

    let tickerData = [];
    let tickerIndex = 0;
    let tickerRotationTimer = null;

    function timeAgo(dateString) {
      const then = new Date(dateString);
      if (isNaN(then)) return "";
      const now = new Date();
      const diffMs = now - then;
      const minutes = Math.floor(diffMs / 60000);
      const hours = Math.floor(minutes / 60);

      if (minutes < 1) return "just now";
      if (minutes < 60) return `${minutes} min ago`;
      if (hours < 24) return `${hours} hr${hours !== 1 ? "s" : ""} ago`;
      const days = Math.floor(hours / 24);
      return `${days} day${days !== 1 ? "s" : ""} ago`;
    }

    function isRecentEnough(dateString) {
      const then = new Date(dateString);
      if (isNaN(then)) return false;
      const now = new Date();
      const diffMs = now - then;
      const hours = diffMs / (1000 * 60 * 60);
      return hours <= MAX_AGE_HOURS;
    }

    function cleanBeerName(name) {
      if (!name) return "";
      return name.replace(/^(a |an )/i, "").trim();
    }

    function parseRating(item) {
      const raw = (item.description || "") + " " + (item.content || "");
      const text = raw.replace(/<[^>]+>/g, " ");

      let match = text.match(/\(([0-9.]+)\s*\/\s*5/i);
      if (match) return match[1];

      match = text.match(/([0-9.]+)\s*\/\s*5/i);
      if (match) return match[1];

      match = text.match(/Rating:\s*([0-9.]+)/i);
      if (match) return match[1];

      return "";
    }

    function parseUntappdTitle(title) {
      let user = "";
      let beer = "";
      let brewery = "";

      if (!title) return { user, beer, brewery };

      let base = title;
      const atIndex = base.toLowerCase().lastIndexOf(" at ");
      if (atIndex !== -1) base = base.slice(0, atIndex);

      let parts = base.split(" is drinking ");
      if (parts.length === 1) parts = base.split(" drank ");

      let rest = "";
      if (parts.length > 1) {
        user = parts[0].trim();
        rest = parts[1].trim();
      } else {
        rest = base.trim();
      }

      let beerCandidate = rest;
      let breweryCandidate = "";

      const bySplit = rest.split(" by ");
      if (bySplit.length > 1) {
        beerCandidate = bySplit[0].trim();
        breweryCandidate = bySplit.slice(1).join(" by ").trim();
      }

      if (!breweryCandidate) {
        const parenMatch = beerCandidate.match(/\(([^)]+)\)\s*$/);
        if (parenMatch) {
          breweryCandidate = parenMatch[1].trim();
          beerCandidate = beerCandidate.replace(/\s*\([^)]+\)\s*$/, "").trim();
        }
      }

      beer = beerCandidate;
      brewery = breweryCandidate;

      return { user, beer, brewery };
    }

    function buildTicker(items) {
      tickerTrack.innerHTML = "";
      if (tickerRotationTimer) {
        clearInterval(tickerRotationTimer);
        tickerRotationTimer = null;
      }

      if (!items || !items.length) {
        renderEmptyTicker("No recent check-ins.");
        return;
      }

      const recentItems = items.filter((item) => isRecentEnough(item.pubDate));

      if (!recentItems.length) {
        renderEmptyTicker("No check-ins in the selected time window.");
        return;
      }

      const maxItems = Math.min(recentItems.length, 20);
      tickerData = recentItems.slice(0, maxItems);
      tickerIndex = 0;

      renderTickerCard(tickerData[tickerIndex], true);

      if (tickerData.length > 1) {
        tickerRotationTimer = setInterval(() => {
          tickerIndex = (tickerIndex + 1) % tickerData.length;
          renderTickerCard(tickerData[tickerIndex], false);
        }, 8000);
      }
    }

    function renderEmptyTicker(message) {
      const card = document.createElement("div");
      card.className = "ticker-card";
      card.innerHTML = `
        <div class="ticker-line-main">
          <span class="ticker-empty">${message}</span>
        </div>
      `;
      tickerTrack.appendChild(card);
    }

    function renderTickerCard(item, immediate) {
      const { user, beer, brewery } = parseUntappdTitle(item.title);
      const cleanBeer = cleanBeerName(beer);
      const rating = parseRating(item);
      const time = timeAgo(item.pubDate);

      const oldCard = tickerTrack.querySelector(".ticker-card");

      const newCard = document.createElement("div");
      newCard.className = "ticker-card";
      newCard.innerHTML = `
        <div class="ticker-line-main">
          <span class="ticker-user">${user || "Someone"}</span>
          ${cleanBeer ? '<span class="ticker-separator">Â·</span>' : ""}
          ${
            cleanBeer
              ? `<span class="ticker-beer">${cleanBeer}${
                  brewery ? " by " + brewery : ""
                }</span>`
              : ""
          }
        </div>
        <div class="ticker-line-sub">
          ${
            rating
              ? `<span class="ticker-rating">Rated ${rating}/5</span>`
              : ""
          }
          ${
            rating && time
              ? '<span class="ticker-separator">Â·</span>'
              : ""
          }
          ${time ? `<span class="ticker-time">${time}</span>` : ""}
        </div>
      `;

      if (immediate || !oldCard) {
        tickerTrack.innerHTML = "";
        tickerTrack.appendChild(newCard);
        return;
      }

      newCard.classList.add("ticker-card--incoming");
      tickerTrack.appendChild(newCard);

      requestAnimationFrame(() => {
        oldCard.classList.add("ticker-card--outgoing");
        newCard.classList.add("ticker-card--animate-in");
      });

      oldCard.addEventListener(
        "animationend",
        () => {
          if (oldCard.parentNode === tickerTrack) {
            tickerTrack.removeChild(oldCard);
          }
        },
        { once: true }
      );

      newCard.addEventListener(
        "animationend",
        () => {
          newCard.classList.remove(
            "ticker-card--incoming",
            "ticker-card--animate-in"
          );
        },
        { once: true }
      );
    }

    async function fetchCheckins() {
      try {
        statusTime.textContent = "Updatingâ€¦";

        const rssUrl = encodeURIComponent(VENUE_RSS_URL);
        const apiUrl = `https://api.rss2json.com/v1/api.json?rss_url=${rssUrl}`;

        const res = await fetch(apiUrl);
        if (!res.ok) {
          statusTime.textContent = "Feed error";
          return;
        }

        const data = await res.json();
        const items = data.items || [];

        buildTicker(items);
        statusTime.textContent = new Date().toLocaleTimeString();
      } catch (err) {
        console.error(err);
        statusTime.textContent = "Network error";
      }
    }

    function startAutoRefresh() {
      fetchCheckins();
      setInterval(fetchCheckins, REFRESH_MS);
    }

    // ðŸ”‘ FireTV-friendly: focus the button & use OK/Enter to open slideshow
    function setupTvNav() {
      const btn = document.getElementById("slideshowBtn");
      if (btn) {
        btn.setAttribute("tabindex", "0");
        try {
          btn.focus();
        } catch (e) {
          // some environments ignore focus(), that's fine
        }
      }

      document.addEventListener("keydown", (e) => {
        const key = e.key || e.code;
        if (key === "Enter" || key === " " || key === "Space") {
          const b = document.getElementById("slideshowBtn");
          if (b && b.href) {
            window.location.href = b.href;
          }
        }
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      fetchBeersFromSheet();
      startAutoRefresh();
      setupTvNav();
    });
  </script>
</body>
</html>
